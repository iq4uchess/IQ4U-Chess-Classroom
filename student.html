<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Puzzle Viewer - Next / Previous + Responsive</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#fff;
    --muted:#6b7280;
    --accent:#0f1724;
  }
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#111;}
  .wrap{max-width:1200px;margin:28px auto;padding:12px;display:grid;grid-template-columns: 520px 1fr;gap:20px;}
  .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(12,20,30,0.06);}
  /* left column board */
  .board-area{display:flex;flex-direction:column;gap:12px;}
  .board-container{background:linear-gradient(180deg,#f3e9d8,#e7d6b9);aspect-ratio:1;max-width:520px;width:100%;border-radius:6px;position:relative;overflow:hidden;}
  /* place holder for actual chessboard canvas/div */
  #board{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#222;}
  .fen-row{font-size:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center;gap:8px}
  /* right column controls */
  .controls{display:flex;flex-direction:column;gap:12px;}
  .input-card{min-height:120px;}
  .moves-box{min-height:160px;padding:10px;overflow:auto;border-radius:6px;background:#fbfdff;border:1px solid rgba(11,20,40,0.04);}
  /* control strip (next, prev etc.) */
  .control-strip{display:flex;gap:8px;align-items:center;justify-content:flex-end;}
  .btn{background:#0b1220;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600;box-shadow:0 4px 10px rgba(2,6,23,0.12);}
  .btn.secondary{background:#11182766;color:#fff;padding:7px 10px;box-shadow:none}
  /* disabled */
  .btn[disabled]{opacity:.45;cursor:not-allowed}
  /* small screens: stack and move control strip to bottom fixed */
  @media (max-width:880px){
    .wrap{grid-template-columns:1fr;padding:10px;gap:12px;}
    .control-strip{position:fixed;left:0;right:0;bottom:0;padding:10px;background:linear-gradient(180deg,rgba(255,255,255,0.95),rgba(255,255,255,0.98));box-shadow:0 -12px 30px rgba(10,14,20,0.06);justify-content:space-between;}
    .card{padding-bottom:72px} /* room for fixed strip */
    .board-container{max-width:100%;}
    .control-strip .left{display:flex;gap:8px}
  }
  /* simple move list styling */
  ol.moves{margin:0;padding-left:18px;color:#0b1220}
  ol.moves li{margin:6px 0}
  .puzzle-title{font-weight:700}
  .index-badge{background:#e6eefb;color:#0b49a6;padding:6px 10px;border-radius:999px;font-weight:600}
</style>
</head>
<body>

<div class="wrap">
  <!-- LEFT: board -->
  <div class="card board-area">
    <div class="puzzle-header" style="display:flex;align-items:center;justify-content:space-between;">
      <div>
        <span class="puzzle-title" id="puzzleTitle">Puzzle 1</span>
        <div style="font-size:13px;color:var(--muted)">Orientation: <span id="orientation">White</span></div>
      </div>
      <div class="index-badge" id="indexBadge">1 / 10</div>
    </div>

    <div class="board-container" aria-hidden="false">
      <!-- Replace this div with your actual chessboard container (Chessground/Chessboard.js) -->
      <div id="board">Board placeholder â€” replace with your board element</div>
    </div>

    <div class="fen-row card" style="padding:10px;">
      <div>FEN: <span id="fenText">--</span></div>
      <div>
        <label for="orientationSelect" style="font-size:12px;color:var(--muted)">Orientation</label>
        <select id="orientationSelect">
          <option>White</option>
          <option>Black</option>
        </select>
      </div>
    </div>
  </div>

  <!-- RIGHT: inputs and moves -->
  <div class="card controls">
    <div class="input-card card" style="padding:12px;">
      <h3 style="margin:0 0 6px 0">PGN / FEN Input</h3>
      <textarea id="pgnInput" placeholder="Paste PGN or FEN here" style="width:100%;min-height:120px;border-radius:6px;border:1px solid #e6eef5;padding:8px;"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end">
        <button id="loadPgnBtn" class="btn secondary">Load PGN</button>
        <button id="resetBtn" class="btn secondary">Reset</button>
      </div>
    </div>

    <div>
      <h4 style="margin:0 0 6px 0">Moves (hidden by default)</h4>
      <div class="moves-box" id="movesBox">
        <ol class="moves" id="movesList"></ol>
      </div>
    </div>

    <!-- extra space so control-strip (mobile) doesn't overlap -->
    <div style="height:10px"></div>
  </div>
</div>

<!-- Control strip (visible on desktop top-right or fixed bottom on mobile) -->
<div class="control-strip card" role="toolbar" aria-label="Puzzle controls" style="margin:12px;max-width:1200px;margin-left:auto;margin-right:auto;">
  <div class="left" style="display:flex;gap:8px;align-items:center">
    <button id="undoBtn" class="btn secondary">Undo</button>
    <button id="prevBtn" class="btn">Previous</button>
    <button id="nextBtn" class="btn">Next</button>
  </div>
  <div style="display:flex;gap:8px;align-items:center">
    <button id="loadBtn" class="btn secondary">Load PGN</button>
    <button id="flipBtn" class="btn secondary">Flip</button>
  </div>
</div>

<script>
/*
  ===== Integrate this with your board library =====
  Replace:
    - setPositionFromFEN(fen)  -> should set the board position to the FEN.
    - loadPGNIntoBoard(pgn)    -> should load a PGN into the board and show moves.
    - clearBoardAndReset()     -> optional: reset board to empty/default state.
    - getCurrentOrientation()  -> return 'white' or 'black' as string
    - flipBoard()              -> flip board orientation visually
  If you use chess.js + board.js, call chess.load(pgn) or board.position(fen) accordingly.
*/

const puzzles = [
  // sample puzzles: replace with your real list; each object can contain fen, pgn, title
  { title: "Pin tactic", fen: "1nk2br1/1pp5/p2B1q1p/3Pp3/6b1/1B3N2/PP2QPP1/2R2RK1 b - - 0 21", pgn: "1. Bxf3 Rxc7+ 2. Kd8 Qxf3 3. Qxf3" },
  { title: "Mate in 2", fen: "r1bq1rk1/pp1n1ppp/2n1p3/2bpP3/2B1P3/2N2N2/PPP2PPP/R1BQ1RK1 w - - 0 1", pgn: "1. Nxd5 exd5 2. Bxd5" },
  // ... add the rest of your puzzles
];

let currentIndex = 0;

/* ---------- Hook up UI elements ---------- */
const boardEl = document.getElementById('board');
const fenText = document.getElementById('fenText');
const orientationSelect = document.getElementById('orientationSelect');
const movesList = document.getElementById('movesList');
const puzzleTitle = document.getElementById('puzzleTitle');
const indexBadge = document.getElementById('indexBadge');

const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const flipBtn = document.getElementById('flipBtn');
const loadBtn = document.getElementById('loadBtn');
const loadPgnBtn = document.getElementById('loadPgnBtn');
const resetBtn = document.getElementById('resetBtn');
const pgnInput = document.getElementById('pgnInput');

prevBtn.addEventListener('click', loadPreviousPuzzle);
nextBtn.addEventListener('click', loadNextPuzzle);
flipBtn.addEventListener('click', () => {
  // call your board flip method here
  flipBoard();
});
loadBtn.addEventListener('click', () => { loadFromInput(); });
loadPgnBtn.addEventListener('click', () => { loadFromInput(); });
resetBtn.addEventListener('click', () => { resetBoard(); });

orientationSelect.addEventListener('change', () => {
  const val = orientationSelect.value.toLowerCase();
  setBoardOrientation(val);
});

/* ---------- Primary functions ---------- */

function loadPuzzle(index){
  if(index < 0 || index >= puzzles.length) return;
  currentIndex = index;

  const p = puzzles[index];
  // Update UI
  puzzleTitle.textContent = p.title || `Puzzle ${index+1}`;
  indexBadge.textContent = `${index+1} / ${puzzles.length}`;
  fenText.textContent = p.fen || 'n/a';

  // Update moves list (simple split on spaces from pgn)
  renderMovesFromPGN(p.pgn || "");

  // Load on the board:
  // If you have FEN: set board position from FEN; if PGN: load PGN.
  // Replace the next lines with your actual loader.
  if(p.fen && typeof setPositionFromFEN === 'function'){
    setPositionFromFEN(p.fen);
  } else if(p.pgn && typeof loadPGNIntoBoard === 'function'){
    loadPGNIntoBoard(p.pgn);
  } else {
    // fallback: show FEN text inside board placeholder
    boardEl.textContent = p.fen ? p.fen : (p.pgn ? p.pgn : 'No data');
  }

  // update button states
  prevBtn.disabled = currentIndex === 0;
  nextBtn.disabled = currentIndex === puzzles.length - 1;
}

function loadNextPuzzle(){
  if(currentIndex < puzzles.length - 1){
    loadPuzzle(currentIndex + 1);
  } else {
    // optional: loop to start
    // loadPuzzle(0);
  }
}

function loadPreviousPuzzle(){
  if(currentIndex > 0){
    loadPuzzle(currentIndex - 1);
  }
}

function renderMovesFromPGN(pgn){
  // naive sanitize & split - you may want a PGN parser for nicer formatting
  movesList.innerHTML = "";
  if(!pgn) return;
  // remove move numbers e.g. "1.", "2..." and result "1-0"
  const cleaned = pgn.replace(/\d+\.(\.\.)?/g,'').replace(/1-0|0-1|1\/2-1\/2|\*/g,'').trim();
  const tokens = cleaned.split(/\s+/).filter(t => t.length>0);
  // build list items in pairs (move number)
  const ol = document.createDocumentFragment();
  for(let i=0;i<tokens.length;i+=2){
    const li = document.createElement('li');
    const white = tokens[i] || '';
    const black = tokens[i+1] || '';
    li.innerHTML = `<strong>${Math.floor(i/2)+1}.</strong> ${white} ${black ? '&nbsp;&nbsp;&nbsp;'+black : ''}`;
    ol.appendChild(li);
  }
  movesList.appendChild(ol);
}

/* ---------- Input loader / reset ---------- */
function loadFromInput(){
  const txt = pgnInput.value.trim();
  if(!txt) return alert('Please paste PGN or FEN in the input area.');
  // naive detect: contains spaces and dots => PGN else treat as FEN
  if(txt.includes('.') || txt.includes('1-0') || txt.includes('0-1')){
    // PGN
    if(typeof loadPGNIntoBoard === 'function') loadPGNIntoBoard(txt);
    else boardEl.textContent = txt;
    renderMovesFromPGN(txt);
  } else {
    // FEN
    if(typeof setPositionFromFEN === 'function') setPositionFromFEN(txt);
    else boardEl.textContent = txt;
    fenText.textContent = txt;
  }
}

function resetBoard(){
  // call your own reset function if exists
  if(typeof clearBoardAndReset === 'function') clearBoardAndReset();
  else {
    boardEl.textContent = "Board placeholder";
    movesList.innerHTML = "";
    fenText.textContent = "--";
  }
}

/* ---------- Orientation helpers (replace to call your board library if needed) ---------- */
function setBoardOrientation(dir){
  // dir = 'white' or 'black'
  document.getElementById('orientation').textContent = dir.charAt(0).toUpperCase() + dir.slice(1);
  // if your board lib supports setOrientation:
  if(typeof setBoardOrientationLib === 'function') setBoardOrientationLib(dir);
}
function getCurrentOrientation(){
  return orientationSelect.value.toLowerCase();
}
function flipBoard(){
  // toggle select & call library flip if available
  orientationSelect.value = orientationSelect.value === 'White' ? 'Black' : 'White';
  setBoardOrientation(orientationSelect.value.toLowerCase());
  if(typeof flipBoardLib === 'function') flipBoardLib();
}

/* ---------- Placeholder board API functions (implement or map to your actual ones) ---------- */
/* Example integration points you should replace with your real functions: */
/* --- Example using Chessboard.js: 
    function setPositionFromFEN(fen){ board.position(fen); }
    function loadPGNIntoBoard(pgn){ chess.load_pgn(pgn); board.position(chess.fen()); render moves... }
    function flipBoardLib(){ board.flip(); }
*/
function setPositionFromFEN(fen){
  // REPLACE with your board set function
  boardEl.textContent = fen;
}
function loadPGNIntoBoard(pgn){
  // REPLACE with your PGN loader
  // If you use chess.js:
  //   chess.load_pgn(pgn); board.position(chess.fen());
  boardEl.textContent = "[PGN loaded]";
}
function clearBoardAndReset(){
  boardEl.textContent = "Board reset";
}

/* ---------- Initialize first puzzle ---------- */
if(puzzles.length>0) loadPuzzle(0);
else resetBoard();

</script>
</body>
</html>

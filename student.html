<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IQ4U â€” Student Board</title>

  <!-- Chessboard.js CSS (working CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/css/chessboard-1.0.0.min.css" />

  <style>
    body { font-family: Arial, sans-serif; padding: 16px; background: #f4f4f4; }
    .controls { display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 10px; }
    button { padding: 8px 12px; border: none; background: #333; color: white; border-radius: 6px; cursor: pointer; }
    #board { width: 400px; }
    .container { display: grid; grid-template-columns: 420px 1fr; gap: 20px; }
    #movesList { background: white; padding: 8px; border-radius: 8px; height: 250px; overflow-y: auto; }
    textarea { width: 100%; height: 140px; padding: 8px; border-radius: 6px; }
    .panel { background: white; padding: 12px; border-radius: 8px; }
  </style>
</head>

<body>

  <!-- Top Control Buttons -->
  <div class="controls">
    <button id="undoBtn">Undo</button>
    <button id="prevBtn">Previous</button>
    <button id="nextBtn">Next</button>
    <button id="flipBtn">Flip</button>
  </div>

  <div class="container">

    <!-- BOARD AREA -->
    <div>
      <div id="board"></div>
      <p>FEN: <span id="fenDisplay"></span></p>
    </div>

    <!-- SIDE PANEL -->
    <div>
      <div class="panel">
        <h3>PGN / FEN Input</h3>
        <textarea id="pgnInput" placeholder="Paste PGN here"></textarea>
        <button id="loadPgnBtn">Load PGN</button>
        <button id="loadFenBtn">Load FEN</button>
        <button id="resetBtn">Reset</button>
      </div>

      <div class="panel">
        <h3>Moves</h3>
        <div id="movesList"></div>
      </div>
    </div>

  </div>

  <!-- JS LIBRARIES (WORKING CDNs) -->

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Chess.js (working CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chess.js@0.13.4/chess.min.js"></script>

  <!-- Chessboard.js (working CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/js/chessboard-1.0.0.min.js"></script>

  <script>
    let game = new Chess();
    let board = null;
    let pgnMoves = [];
    let stepIndex = 0;

    function updateFen() {
      document.getElementById("fenDisplay").textContent = game.fen();
    }

    function refreshMoves() {
      const moves = game.history();
      let html = "";
      moves.forEach((m, idx) => {
        const num = Math.floor(idx / 2) + 1;
        if (idx % 2 === 0) html += `<b>${num}.</b> `;
        html += m + " ";
      });
      document.getElementById("movesList").innerHTML = html;
    }

    function onDrop(source, target) {
      let move = game.move({ from: source, to: target, promotion: "q" });
      if (move === null) return "snapback";

      updateFen();
      refreshMoves();
    }

    function onSnapEnd() {
      board.position(game.fen());
    }

    function initBoard() {
      board = Chessboard("board", {
        draggable: true,
        position: "start",
        onDrop: onDrop,
        onSnapEnd: onSnapEnd
      });
      updateFen();
    }

    // BUTTON CONTROLS
    document.getElementById("undoBtn").onclick = () => {
      game.undo();
      board.position(game.fen());
      updateFen();
      refreshMoves();
    };

    document.getElementById("flipBtn").onclick = () => board.flip();

    document.getElementById("resetBtn").onclick = () => {
      game.reset();
      board.position("start");
      pgnMoves = [];
      stepIndex = 0;
      updateFen();
      refreshMoves();
    };

    document.getElementById("loadFenBtn").onclick = () => {
      const fen = document.getElementById("pgnInput").value.trim();
      if (!game.load(fen)) {
        alert("Invalid FEN");
        return;
      }
      board.position(fen);
      updateFen();
      refreshMoves();
    };

    document.getElementById("loadPgnBtn").onclick = () => {
      const pgn = document.getElementById("pgnInput").value.trim();
      const tmp = new Chess();

      if (!tmp.load_pgn(pgn)) {
        alert("Invalid PGN");
        return;
      }

      pgnMoves = tmp.history();
      stepIndex = 0;

      game.reset();
      board.position("start");

      updateFen();
      refreshMoves();
    };

    document.getElementById("nextBtn").onclick = () => {
      if (stepIndex >= pgnMoves.length) return;
      game.move(pgnMoves[stepIndex]);
      stepIndex++;
      board.position(game.fen());
      updateFen();
      refreshMoves();
    };

    document.getElementById("prevBtn").onclick = () => {
      if (stepIndex <= 0) return;
      game.undo();
      stepIndex--;
      board.position(game.fen());
      updateFen();
      refreshMoves();
    };

    // INIT
    initBoard();
  </script>

</body>
</html>
